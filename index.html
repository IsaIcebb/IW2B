<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Clínica Médica - Cadastro de Pacientes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body {
        background: linear-gradient(135deg, #e0f7fa, #b2ebf2, #80deea);
        min-height: 100vh;
        font-family: 'Poppins', sans-serif;
      }

      h1 {
        text-align: center;
        margin: 20px 0;
        font-weight: 700;
        color: #00796b;
      }

      .card {
        border-radius: 15px;
        box-shadow: 0 8px 16px #000000;
        border: none;
      }

      .btn-custom {
        background-color: #00796b;
        color: #fff;
        border-radius: 8px;
      }

      .btn-custom:hover {
        background-color: #004d40;
        color: #fff;
      }

      table th {
        background: #00796b !important;
        color: #fff;
        text-align: center;
      }
      table td {
        vertical-align: middle;
      }

      .ativo-badge {
        padding: 5px 10px;
        border-radius: 12px;
        font-size: 0.85rem;
      }
      .ativo {
        background: #c8e6c9;
        color: #256029;
      }
      .inativo {
        background: #ffcdd2;
        color: #b71c1c;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1> Cadastro de Pacientes</h1>

      <div class="card p-4 mb-4">
        <h5 class="mb-3 text-center">Informações do Paciente</h5>
        <div class="row g-3">
          <input type="hidden" id="id">
          <div class="col-md-6">
            <input type="text" id="nome" class="form-control" placeholder="Nome Completo">
          </div>
          <div class="col-md-6">
            <input type="email" id="email" class="form-control" placeholder="E-mail">
          </div>
          <div class="col-md-6">
            <input type="text" id="telefone" class="form-control" placeholder="Telefone">
          </div>
          <div class="col-md-6 d-flex align-items-center">
            <label class="me-2">Ativo:</label>
            <input type="checkbox" id="ativo" checked>
          </div>
        </div>

        <div class="text-center mt-4">
          <button class="btn btn-custom px-4" onclick="salvar()">Salvar</button>
          <button class="btn btn-outline-secondary px-4" onclick="limpar()">Cancelar</button>
        </div>
      </div>

      <div class="card p-4 mb-4">
        <div class="row g-2 align-items-center">
          <div class="col-md-9">
            <input type="text" id="pesquisa" class="form-control" placeholder="Pesquisar por nome ou email">
          </div>
          <div class="col-md-3 d-flex gap-2">
            <button class="btn btn-custom w-100" onclick="carregarPesquisa()">Pesquisar</button>
            <button class="btn btn-outline-secondary w-100" onclick="carregar()">Listar Todos</button>
          </div>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Email</th>
              <th>Telefone</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="tabela"></tbody>
        </table>
      </div>
    </div>

    <script>
      const API_URL = "http://localhost:8081/trabalho/usuarios.php"; 

      function carregar(pesquisa = "") {
          const tbody = document.querySelector("#tabela");
          tbody.innerHTML = "";

          let url = API_URL;
          if (pesquisa) {
              url += "?pesquisa=" + encodeURIComponent(pesquisa);
          }
          fetch(url)
            .then(resposta => resposta.json())
            .then(dados => {
                dados.forEach(pacientes => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${pacientes.id}</td>
                        <td>${pacientes.nome}</td>
                        <td>${pacientes.email}</td>
                        <td>${pacientes.telefone}</td>
                        <td>
                          <span class="ativo-badge ${pacientes.ativo == 1 ? 'ativo' : 'inativo'}">
                            ${pacientes.ativo == 1 ? 'Ativo' : 'Inativo'}
                          </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick='editar(${JSON.stringify(pacientes)})'>Editar</button>
                            <button class="btn btn-sm btn-danger" onclick='excluir(${pacientes.id})'>Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
      }

      function carregarPesquisa() {
          const valor = document.getElementById("pesquisa").value;
          carregar(valor);
      }

      async function salvar() {
          const id = document.getElementById("id").value;
          const nome = document.getElementById("nome").value;
          const email = document.getElementById("email").value;
          const telefone = document.getElementById("telefone").value;
          const ativo = document.getElementById("ativo").checked ? 1 : 0;

          const payload = {
              id: id,
              nome: nome,
              email: email,
              telefone: telefone,
              ativo: ativo
          };

          if (id) {
              await fetch(API_URL, { method: "PUT", body: JSON.stringify(payload) });
          } else {
              await fetch(API_URL, { method: "POST", body: JSON.stringify(payload) });
          }

          limpar();
          carregar();
      }

      function editar(paciente) {
          document.getElementById("id").value = paciente.id;
          document.getElementById("nome").value = paciente.nome;
          document.getElementById("email").value = paciente.email;
          document.getElementById("telefone").value = paciente.telefone;
          document.getElementById("ativo").checked = paciente.ativo == 1;
      }

      async function excluir(id) {
          if (confirm("Tem certeza que quer excluir esse paciente?")) {
              await fetch(API_URL + "?id=" + id, { method: "DELETE" });
              carregar();
          }
      }

      function limpar() {
          document.getElementById("id").value = "";
          document.getElementById("nome").value = "";
          document.getElementById("email").value = "";
          document.getElementById("telefone").value = "";
          document.getElementById("ativo").checked = true;
      }

      carregar();
    </script>
  </body>

  
 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js">
    

    </script>
  </body>
</html>
